================================================================================
COMMUNITY MEAL MANAGEMENT - COMPLETE PAGE SPECIFICATIONS
RoomMate Manager - Meal & Grocery Module Documentation
================================================================================

OVERVIEW
--------
The Community Meal system is the most complex and unique feature of RoomMate Manager.
It handles chef management, weekly menus, rotating grocery teams, OCR receipt scanning,
cost splitting, and team performance ratings.

KEY FEATURES
-----------
âœ“ Chef profile management with salary splitting
âœ“ Weekly menu planning with food photos
âœ“ Automated grocery team rotation (4-week cycles)
âœ“ OCR receipt scanning (Tesseract.js + Azure CV)
âœ“ Dynamic cost splitting based on meal participation
âœ“ Team performance rating system (1-5 stars)
âœ“ Flexible participation (Full/Lunch/Dinner/Custom)
âœ“ Water opt-in/opt-out
âœ“ Budget models (Fixed vs Dynamic)
âœ“ Admin approval workflow for purchases

================================================================================
1. COMMUNITY MEAL DASHBOARD
================================================================================

Route: /meals
Component: CommunityMealDashboardPage.tsx
Permission: Meal Participant or Admin

LAYOUT STRUCTURE
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Community Meals ğŸ½ï¸                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Your Meal Plan: Full (B+L+D) + Water       â”‚
â”‚ Weekly Cost: â‚¹265 | Chef Share: â‚¹882/month â”‚
â”‚ [Change Preferences]                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tabs: [This Week's Menu] [Grocery Teams]   â”‚
â”‚       [Cost Summary] [Settings]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ THIS WEEK'S MENU (Jan 1-7)                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Monday  â”‚ Breakfast â”‚ Lunch  â”‚ Dinnerâ”‚   â”‚
â”‚ â”‚ Jan 1   â”‚ Idli      â”‚ Rice + â”‚ Roti +â”‚   â”‚
â”‚ â”‚         â”‚ Sambar    â”‚ Chickenâ”‚ Dal   â”‚   â”‚
â”‚ â”‚         â”‚ [Photo]   â”‚ Curry  â”‚ Paneerâ”‚   â”‚
â”‚ â”‚         â”‚           â”‚ [Photo]â”‚ [Photoâ”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ Tuesday â”‚...                           â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GROCERY DUTY THIS WEEK                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Team A (Sarah & Mike)                â”‚   â”‚
â”‚ â”‚ Your team's turn this week!          â”‚   â”‚
â”‚ â”‚ Budget: â‚¹5,000 | Spent: â‚¹4,500 âœ“    â”‚   â”‚
â”‚ â”‚ Status: Purchased âœ“ Pending Approvalâ”‚   â”‚
â”‚ â”‚ [View Receipt] [Upload More]        â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                              â”‚
â”‚ OR (if not your turn):                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ This Week: Team B (John & Lisa)     â”‚   â”‚
â”‚ â”‚ Your Turn: Week of Jan 15           â”‚   â”‚
â”‚ â”‚ Team: You + Alex                    â”‚   â”‚
â”‚ â”‚ [View Rotation Schedule]            â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CHEF INFORMATION                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ [Photo] Chef Kumar                   â”‚   â”‚
â”‚ â”‚ â­ 4.5/5 (24 ratings)                â”‚   â”‚
â”‚ â”‚ Contact: +91-9999999999             â”‚   â”‚
â”‚ â”‚ Salary: â‚¹15,000/month               â”‚   â”‚
â”‚ â”‚ Your Share: â‚¹882/month (17 members)â”‚   â”‚
â”‚ â”‚ [Rate Chef] [View Profile]          â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

COMPONENTS
----------
1. MealPlanBanner
   - Current plan display
   - Weekly cost
   - Chef share
   - Edit button
   
2. TabNavigation
   - This Week's Menu
   - Grocery Teams
   - Cost Summary
   - Settings (admin only)
   
3. WeeklyMenuGrid
   - 7 days Ã— 3 meals = 21 cards
   - Each card: Meal name, items, photo
   - Click to see details
   - Vote on menu changes
   
4. GroceryDutyCard
   - Conditional display (your turn vs others)
   - Team members
   - Budget info
   - Status
   - Action buttons
   
5. ChefInfoCard
   - Photo, name, rating
   - Contact info
   - Salary breakdown
   - Actions

API CALLS
---------
```typescript
// Get user's meal participation
GET /rest/v1/meal_participants?user_id=eq.{userId}

// Get this week's menu
GET /rest/v1/menus?community_meal_id=eq.{mealId}&week_start_date=eq.{monday}

// Get current grocery team
GET /rest/v1/grocery_teams?community_meal_id=eq.{mealId}&week_number=eq.{week}

// Get chef info
GET /rest/v1/chefs?apartment_id=eq.{apartmentId}&status=eq.active
```

================================================================================
2. WEEKLY MENU PLANNER (ADMIN)
================================================================================

Route: /admin/meals/menu
Component: MenuPlannerPage.tsx
Permission: Admin

LAYOUT STRUCTURE
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Weekly Menu Planner                          â”‚
â”‚ Week of: [Jan 1-7, 2025 â–¼]                 â”‚
â”‚ [Save as Draft] [Publish] [Copy Last Week] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚ Breakfast  â”‚ Lunch     â”‚ Dinner   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Mon    â”‚ [Edit âœï¸]  â”‚ [Edit âœï¸] â”‚ [Edit âœï¸]â”‚
â”‚ Jan 1  â”‚ Idli       â”‚ Rice +    â”‚ Roti +  â”‚
â”‚        â”‚ Sambar     â”‚ Chicken   â”‚ Dal     â”‚
â”‚        â”‚ Chutney    â”‚ Curry     â”‚ Paneer  â”‚
â”‚        â”‚ [ğŸ“· Photo] â”‚ [ğŸ“·]      â”‚ [ğŸ“·]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tue    â”‚ [Edit âœï¸]  â”‚ [Edit âœï¸] â”‚ [Edit âœï¸]â”‚
â”‚ Jan 2  â”‚ ...        â”‚ ...       â”‚ ...     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ... (7 days total)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

EDIT MEAL MODAL
--------------
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edit Meal: Monday Lunch                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Main Course *                             â”‚
â”‚ [Rice] [Roti] [Porotta] (checkboxes)    â”‚
â”‚                                            â”‚
â”‚ Curry 1 *                                 â”‚
â”‚ [Chicken Curry___________________]        â”‚
â”‚                                            â”‚
â”‚ Curry 2                                   â”‚
â”‚ [Dal Tadka_______________________]        â”‚
â”‚                                            â”‚
â”‚ Side Dish                                 â”‚
â”‚ [Salad, Raita____________________]        â”‚
â”‚                                            â”‚
â”‚ Dessert (optional)                        â”‚
â”‚ [Ice Cream_______________________]        â”‚
â”‚                                            â”‚
â”‚ Beverage (optional)                       â”‚
â”‚ [Juice___________________________]        â”‚
â”‚                                            â”‚
â”‚ Food Photo (Cloudinary)                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ [Current Photo Preview]        â”‚       â”‚
â”‚ â”‚ [Click to Change]              â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                            â”‚
â”‚ [Cancel] [Save]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

FEATURES
--------
1. Week Navigation
   - Dropdown to select week
   - Previous/Next week buttons
   - Jump to current week
   
2. Bulk Actions
   - Save as Draft (not visible to users)
   - Publish (makes visible + notifies users)
   - Copy Last Week (duplicates all 21 meals)
   - Clear All
   
3. Individual Meal Edit
   - Click any cell to edit
   - Form with meal components
   - Photo upload to Cloudinary
   - Save individual meal
   
4. Menu Templates
   - Save current week as template
   - Load template
   - Useful for rotating menus

CLOUDINARY UPLOAD
-----------------
Folder: /roommate-manager/meals/{meal_id}/photos/
Transformation: w_800,h_600,c_fill,q_auto,f_auto

================================================================================
3. GROCERY TEAM MANAGEMENT
================================================================================

PAGE 3.1: TEAM ROTATION VIEW
---------------------------
Route: /meals/teams
Component: GroceryTeamsPage.tsx
Permission: Meal Participant

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Grocery Team Rotation                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4-Week Cycle: Jan 1 - Jan 28, 2025         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ WEEK 1 (Jan 1-7) - YOUR TURN        â”‚   â”‚
â”‚ â”‚ Team A: Sarah (You) + Mike           â”‚   â”‚
â”‚ â”‚ Status: âœ“ Completed                  â”‚   â”‚
â”‚ â”‚ Spent: â‚¹4,500 | Rating: â­ 4.8/5    â”‚   â”‚
â”‚ â”‚ [View Receipt] [View Feedback]      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ WEEK 2 (Jan 8-14) - CURRENT         â”‚   â”‚
â”‚ â”‚ Team B: John + Lisa                  â”‚   â”‚
â”‚ â”‚ Status: â±ï¸ In Progress               â”‚   â”‚
â”‚ â”‚ Budget: â‚¹5,000 | Spent: Not yet     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ WEEK 3 (Jan 15-21)                   â”‚   â”‚
â”‚ â”‚ Team C: Alex + Chris                 â”‚   â”‚
â”‚ â”‚ Status: Scheduled                    â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ WEEK 4 (Jan 22-28)                   â”‚   â”‚
â”‚ â”‚ Team D: David + Emma                 â”‚   â”‚
â”‚ â”‚ Status: Scheduled                    â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Your Next Turn: Week of Feb 5, 2025        â”‚
â”‚ Teammate: Mike                              â”‚
â”‚ [Set Reminder] [Contact Teammate]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

TEAM GENERATION ALGORITHM
------------------------
```typescript
function generateGroceryTeams(participants: User[]): Team[] {
  const teamSize = 2
  const shuffled = shuffle(participants)
  const teams: Team[] = []
  
  for (let i = 0; i < shuffled.length; i += teamSize) {
    const members = shuffled.slice(i, i + teamSize)
    teams.push({
      number: teams.length + 1,
      members,
      weekNumber: (teams.length % 4) + 1
    })
  }
  
  // If odd number, last team has 3 members
  return teams
}

// Example: 17 participants
// Team 1 (2): User 1, User 2
// Team 2 (2): User 3, User 4
// ...
// Team 8 (3): User 15, User 16, User 17 â† 3 members
```

ADMIN TEAM MANAGEMENT
--------------------
Route: /admin/meals/teams
Permission: Admin

Features:
- View all teams
- Manually reassign members
- Override rotation
- Generate new rotation
- View team performance history

```
Generate Teams Button Actions:
1. Get all meal participants
2. Run generation algorithm
3. Create grocery_teams records for 4 weeks
4. Create team_members junction records
5. Notify all users of their assignments
```


PAGE 3.2: UPLOAD GROCERY RECEIPT
-------------------------------
Component: UploadReceiptModal.tsx
Trigger: Grocery team's week, click "Upload Receipt"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload Grocery Receipt              Step 1/4â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Upload Receipt Photo                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚                                 â”‚       â”‚
â”‚ â”‚      ğŸ“· Take Photo             â”‚       â”‚
â”‚ â”‚         or                     â”‚       â”‚
â”‚ â”‚      ğŸ“ Upload from Gallery    â”‚       â”‚
â”‚ â”‚                                 â”‚       â”‚
â”‚ â”‚  [Click to Upload]             â”‚       â”‚
â”‚ â”‚                                 â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚ Max 5MB | JPG, PNG formats               â”‚
â”‚                                            â”‚
â”‚ Already uploaded: 2 receipts              â”‚
â”‚ [receipt1.jpg] [Ã—]                        â”‚
â”‚ [receipt2.jpg] [Ã—]                        â”‚
â”‚                                            â”‚
â”‚ [Back] [Next â†’]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: OCR Processing
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload Grocery Receipt              Step 2/4â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Processing Receipt...                     â”‚
â”‚ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 75%                 â”‚
â”‚ Extracting items and prices...           â”‚
â”‚                                            â”‚
â”‚ (Auto-advances when complete)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: Review & Edit Items
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload Grocery Receipt              Step 3/4â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Review Extracted Items                    â”‚
â”‚ Click any item to edit | [+ Add Item]    â”‚
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚Item Name    â”‚Qty  â”‚Price â”‚Total â”‚âœï¸â”‚Ã—â”‚â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ â”‚Chicken      â”‚3 kg â”‚â‚¹150  â”‚â‚¹450  â”‚âœï¸â”‚Ã—â”‚â”‚
â”‚ â”‚Fish         â”‚2 kg â”‚â‚¹300  â”‚â‚¹600  â”‚âœï¸â”‚Ã—â”‚â”‚
â”‚ â”‚Rice (Basmatiâ”‚10 kgâ”‚â‚¹80   â”‚â‚¹800  â”‚âœï¸â”‚Ã—â”‚â”‚
â”‚ â”‚Tomatoes     â”‚5 kg â”‚â‚¹30   â”‚â‚¹150  â”‚âœï¸â”‚Ã—â”‚â”‚
â”‚ â”‚Onions       â”‚3 kg â”‚â‚¹30   â”‚â‚¹90   â”‚âœï¸â”‚Ã—â”‚â”‚
â”‚ â”‚...          â”‚     â”‚      â”‚      â”‚  â”‚ â”‚â”‚
â”‚ â”‚             â”‚     â”‚      â”‚      â”‚  â”‚ â”‚â”‚
â”‚ â”‚TOTAL        â”‚     â”‚      â”‚â‚¹4,500â”‚  â”‚ â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                            â”‚
â”‚ Confidence: High âœ“ (85% average)         â”‚
â”‚                                            â”‚
â”‚ [Back] [Next â†’]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 4: Additional Details
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload Grocery Receipt              Step 4/4â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Purchase Date *                           â”‚
â”‚ [ğŸ“… Jan 3, 2025]                         â”‚
â”‚                                            â”‚
â”‚ Store Name *                              â”‚
â”‚ [SuperMart_______________________]        â”‚
â”‚                                            â”‚
â”‚ Total Amount *                            â”‚
â”‚ [â‚¹4,500] (auto-calculated)               â”‚
â”‚                                            â”‚
â”‚ Notes (optional)                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚Bought extra vegetables as they â”‚       â”‚
â”‚ â”‚were on sale. Saved â‚¹500.       â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                            â”‚
â”‚ Budget Status:                            â”‚
â”‚ Budget: â‚¹5,000 | Spent: â‚¹4,500           â”‚
â”‚ Under Budget: â‚¹500 âœ“                     â”‚
â”‚                                            â”‚
â”‚ [Back] [Submit for Approval]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

OCR PROCESSING LOGIC
-------------------
```typescript
async function processReceiptOCR(imageUrl: string) {
  // Step 1: Use Tesseract.js for MVP
  const worker = createWorker()
  await worker.load()
  await worker.loadLanguage('eng')
  await worker.initialize('eng')
  
  const { data: { text } } = await worker.recognize(imageUrl)
  await worker.terminate()
  
  // Step 2: Parse extracted text
  const items = parseReceiptText(text)
  
  // Step 3: Extract totals, store name, date
  const parsed = {
    storeName: extractStoreName(text),
    date: extractDate(text),
    items: items,
    subtotal: extractSubtotal(text),
    tax: extractTax(text),
    total: extractTotal(text)
  }
  
  return parsed
}

function parseReceiptText(text: string): GroceryItem[] {
  // Regex patterns for common receipt formats
  const linePattern = /(.+?)\s+(\d+\.?\d*)\s*kg?\s*â‚¹?(\d+\.?\d*)/gi
  const items: GroceryItem[] = []
  
  let match
  while ((match = linePattern.exec(text)) !== null) {
    items.push({
      name: match[1].trim(),
      quantity: parseFloat(match[2]),
      price: parseFloat(match[3]),
      confidence: 0.85 // Calculate actual confidence
    })
  }
  
  return items
}
```

SUBMISSION FLOW
--------------
1. Validate all items have name, qty, price
2. Validate total matches sum of items (Â±5% tolerance)
3. Upload to database:
```typescript
const purchase = {
  grocery_team_id: teamId,
  purchase_date: formData.date,
  total_amount: formData.total,
  receipt_url: imageUrl,
  store_name: formData.storeName,
  status: 'pending_approval',
  submitted_by: userId,
  notes: formData.notes
}

await supabase.from('grocery_purchases').insert(purchase)

// Insert all items
const itemsData = items.map(item => ({
  grocery_purchase_id: purchase.id,
  item_name: item.name,
  quantity: item.quantity,
  unit_price: item.price / item.quantity,
  total_price: item.price,
  confidence_score: item.confidence
}))

await supabase.from('grocery_items').insert(itemsData)
```

4. Send notification to admin
5. Show success message
6. Update team status to "Pending Approval"


PAGE 3.3: ADMIN PURCHASE REVIEW
------------------------------
Route: /admin/meals/purchases
Component: PurchaseReviewPage.tsx
Permission: Admin

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Grocery Purchases - Pending Approval        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Team A (Sarah + Mike) - Week 1       â”‚   â”‚
â”‚ â”‚ Submitted: Jan 3, 2025 10:30 AM     â”‚   â”‚
â”‚ â”‚                                       â”‚   â”‚
â”‚ â”‚ Store: SuperMart                     â”‚   â”‚
â”‚ â”‚ Date: Jan 3, 2025                    â”‚   â”‚
â”‚ â”‚ Total: â‚¹4,500                        â”‚   â”‚
â”‚ â”‚ Budget: â‚¹5,000                       â”‚   â”‚
â”‚ â”‚ Variance: -â‚¹500 (Under âœ“)           â”‚   â”‚
â”‚ â”‚                                       â”‚   â”‚
â”‚ â”‚ Items: 28 | [View Receipt ğŸ“·]        â”‚   â”‚
â”‚ â”‚ [View Itemized List â–¼]              â”‚   â”‚
â”‚ â”‚                                       â”‚   â”‚
â”‚ â”‚ Notes: "Bought extra vegetables..."  â”‚   â”‚
â”‚ â”‚                                       â”‚   â”‚
â”‚ â”‚ [Approve âœ“] [Reject Ã—] [Request Info]â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

APPROVE FLOW
-----------
1. Admin clicks "Approve"
2. Confirmation modal
3. System actions:
   - Update purchase status to 'approved'
   - Record approved_by and approved_at
   - Trigger cost calculation Edge Function
   - Create bills for all meal participants
   - Send notifications
   - Unlock rating for other participants

COST CALCULATION EDGE FUNCTION
-----------------------------
```typescript
export async function calculateMealCosts({
  groceryPurchaseId
}: {
  groceryPurchaseId: string
}) {
  // Get purchase details
  const { data: purchase } = await supabase
    .from('grocery_purchases')
    .select('*, grocery_teams(*)')
    .eq('id', groceryPurchaseId)
    .single()
  
  // Get all meal participants
  const { data: participants } = await supabase
    .from('meal_participants')
    .select('*')
    .eq('community_meal_id', purchase.grocery_teams.community_meal_id)
  
  const totalCost = purchase.total_amount
  
  // Calculate shares based on meal types
  const shares = participants.map(p => {
    let multiplier = 0
    
    if (p.meal_types.includes('breakfast')) multiplier += 0.3
    if (p.meal_types.includes('lunch')) multiplier += 0.4
    if (p.meal_types.includes('dinner')) multiplier += 0.5
    
    // Full meals (all 3) = 1.2, normalize to 1.0 for calculation
    const normalizedMultiplier = multiplier / 1.2
    
    let share = totalCost * normalizedMultiplier
    
    // Add water cost if opted in
    if (p.include_water) {
      share += 50 // â‚¹50 per week for water
    }
    
    return {
      user_id: p.user_id,
      amount: Math.round(share)
    }
  })
  
  // Create bill splits
  for (const share of shares) {
    await supabase.from('bill_splits').insert({
      member_id: share.user_id,
      bill_type_id: 'grocery_bill_type_id',
      amount: share.amount,
      payment_status: 'unpaid'
    })
  }
  
  return { success: true, shares }
}
```


PAGE 3.4: TEAM RATING
-------------------
Component: RateTeamModal.tsx
Trigger: End of week, non-team members rate

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rate Grocery Team                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Team A (Sarah + Mike)                     â”‚
â”‚ Week: Jan 1-7, 2025                      â”‚
â”‚ Total Spent: â‚¹4,500                      â”‚
â”‚                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Rate each category:                â”‚   â”‚
â”‚ â”‚                                     â”‚   â”‚
â”‚ â”‚ Budget Management                  â”‚   â”‚
â”‚ â”‚ â­â­â­â­â­ (5/5)                     â”‚   â”‚
â”‚ â”‚ Came under budget, great!          â”‚   â”‚
â”‚ â”‚                                     â”‚   â”‚
â”‚ â”‚ Quality of Items                   â”‚   â”‚
â”‚ â”‚ â­â­â­â­â­ (5/5)                     â”‚   â”‚
â”‚ â”‚ Fresh and high quality             â”‚   â”‚
â”‚ â”‚                                     â”‚   â”‚
â”‚ â”‚ Timeliness                         â”‚   â”‚
â”‚ â”‚ â­â­â­â­â­ (5/5)                     â”‚   â”‚
â”‚ â”‚ Shopped early in the week          â”‚   â”‚
â”‚ â”‚                                     â”‚   â”‚
â”‚ â”‚ Communication                      â”‚   â”‚
â”‚ â”‚ â­â­â­â­â˜† (4/5)                     â”‚   â”‚
â”‚ â”‚ Good updates                       â”‚   â”‚
â”‚ â”‚                                     â”‚   â”‚
â”‚ â”‚ Overall: â­ 4.75/5 (auto-avg)      â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                            â”‚
â”‚ Feedback (optional):                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚Great job! Everything was fresh and â”‚   â”‚
â”‚ â”‚they managed the budget well.       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                            â”‚
â”‚ [Cancel] [Submit Rating]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

RATING SYSTEM
------------
Categories (1-5 stars each):
1. Budget Management (did they stay within budget?)
2. Quality of Items (freshness, brands)
3. Timeliness (shopped early vs last minute?)
4. Communication (updates to group?)

Overall Rating: Average of 4 categories

Loyalty Points:
- 5 stars: +30 points per member
- 4-4.9 stars: +25 points per member
- 3-3.9 stars: +15 points per member
- <3 stars: -100 points per member (poor performance)

================================================================================
[Document continues...]
================================================================================

Total Pages: 8 major pages
Status: Core pages documented
Remaining: Settings, Cost Summary, Reports

This module is the most complex in the application!

